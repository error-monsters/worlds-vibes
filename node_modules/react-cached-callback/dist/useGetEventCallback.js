"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var react_1 = require("react");
var getKey_1 = __importDefault(require("./getKey"));
function useGetEventCallback(createCallback, params) {
    return useGetEventCallbackInner(createCallback, getKey_1.default(params));
}
exports.default = useGetEventCallback;
function useGetEventCallbackInner(createCallback, getCacheKey) {
    var callbacksCache = react_1.useRef();
    if (!callbacksCache.current) {
        callbacksCache.current = {};
    }
    react_1.useEffect(function () {
        // update old and clear unused callbacks
        Object.keys(callbacksCache.current).forEach(function (cacheKey) {
            if (callbacksCache.current[cacheKey].next) {
                callbacksCache.current[cacheKey].cached = callbacksCache.current[cacheKey].next;
                delete callbacksCache.current[cacheKey].next;
            }
            else {
                delete callbacksCache.current[cacheKey];
            }
        });
    });
    return (function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var cacheKey = getCacheKey.apply(void 0, args);
        var cache4Function = callbacksCache.current[cacheKey];
        if (!cache4Function) {
            cache4Function = {};
            cache4Function.cached = function () {
                if (typeof console !== 'undefined' && typeof console.warn === 'function') {
                    console.warn('useEventCallbacks. You should not call an event handler while rendering.');
                }
            };
            cache4Function.func = function () {
                var callArgs = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    callArgs[_i] = arguments[_i];
                }
                return cache4Function.cached.apply(cache4Function, callArgs);
            };
            callbacksCache.current[cacheKey] = cache4Function;
        }
        cache4Function.next = createCallback.apply(void 0, args);
        return cache4Function.func;
    });
}
